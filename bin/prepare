#!/bin/bash
# -*- mode: bash; tab-width: 2; -*-
# vim: ts=2 sw=2 ft=bash noet

# source the Nos framework
. /opt/nos/common.sh

# initialize Nos with the original arguments
nos_init "$@"

# source common lib
. ${engine_lib_dir}/nodejs.sh

# install node.js or io.js
nodejs_install_runtime

# run npm rebuild only if the runtime has changed
nodejs_npm_rebuild

# persist all environment variables
nos_persist_evars

# persist http port evar
nodejs_persist_web_port_evar

# run npm install
nodejs_npm_install

# set the node.js runtime in cache
nodejs_set_runtime

# javascript asset runtime installation (bower, gulp, etc)
nodejs_prepare_asset_runtime

# javascript asset environment configuration
nodejs_configure_asset_environment
